<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 68</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/pdfmake.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/vfs_fonts.js"></script>
    <style>
      body {
        font-family: "Sarabun", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div
      class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-8 shadow-lg"
    >
      <div class="container mx-auto px-4 text-center">
        <h6 class="text-md font-bold mb-2">‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568 ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏ß‡∏±‡∏î‡πÑ‡∏ó‡∏¢‡∏á‡∏≤‡∏°</h6>
      </div>
    </div>

    <div class="container mx-auto px-4 py-8">
      <!-- Loading indicator -->
      <div id="loading" class="text-center py-8">
        <div
          class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"
        ></div>
        <p class="mt-2 text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
      </div>

      <!-- Statistics Cards -->
      <div id="statsSection" class="hidden mb-8">
        <h2 class="text-2xl font-semibold text-gray-800 mb-4">
          ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤
        </h2>
        <div id="statsCards" class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
          <!-- Stats cards will be populated here -->
        </div>
      </div>

      <!-- Search Section -->
      <div
        id="searchSection"
        class="hidden bg-white rounded-xl shadow-lg p-6 mb-8"
      >
        <h2 class="text-2xl font-semibold text-gray-800 mb-6">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>

        <!-- Name/Surname Search -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label
          >
          <input
            type="text"
            id="nameSearch"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•..."
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          />
        </div>

        <!-- Status Filter Buttons -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-3"
            >‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label
          >
          <div id="statusButtons" class="flex flex-wrap gap-2">
            <button
              onclick="filterByStatus('all')"
              class="status-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-blue-600 text-white"
            >
              üìã ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button
              onclick="filterByStatus('‡∏ï‡∏£‡∏µ')"
              class="status-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-blue-100"
            >
              ü•â ‡∏ï‡∏£‡∏µ
            </button>
            <button
              onclick="filterByStatus('‡πÇ‡∏ó')"
              class="status-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-blue-100"
            >
              ü•à ‡πÇ‡∏ó
            </button>
            <button
              onclick="filterByStatus('‡πÄ‡∏≠‡∏Å')"
              class="status-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-blue-100"
            >
              ü•á ‡πÄ‡∏≠‡∏Å
            </button>
            <button
              onclick="filterByStatus('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö')"
              class="status-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-blue-100"
            >
              üö´ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö
            </button>
            <button
              onclick="filterByStatus('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß')"
              class="status-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-blue-100"
            >
              ‚úÖ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß
            </button>
          </div>
        </div>

        <!-- Classroom Dropdown -->
        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label
          >
          <select
            id="classroomSelect"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <option value="‡∏õ.4">‡∏õ.4</option>
            <option value="‡∏õ.5">‡∏õ.5</option>
            <option value="‡∏õ.6">‡∏õ.6</option>
            <option value="‡∏°.1/1">‡∏°.1/1</option>
            <option value="‡∏°.1/2">‡∏°.1/2</option>
            <option value="‡∏°.2">‡∏°.2</option>
            <option value="‡∏°.3">‡∏°.3</option>
          </select>
        </div>
      </div>

      <!-- Classroom Table Results -->
      <!-- Classroom Table Results -->
      <div
        id="classroomResults"
        class="hidden bg-white rounded-xl shadow-lg p-6 mb-8"
      >
        <div class="flex justify-end items-center mb-4 gap-2">
          <button
            id="printClassroomBtn"
            onclick="printClassroomTable()"
            class="hidden bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
          >
            üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
          </button>

          <button
            id="printPdfBtn"
            onclick="printPdfClassroom()"
            class="hidden bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
          >
            üìÑ ‡∏û‡∏¥‡∏°‡∏û‡πå PDF
          </button>
        </div>

        <div class="overflow-x-auto" id="classroomTableWrapper">
          <table class="w-full table-auto" id="classroomTable">
            <thead>
              <tr class="bg-blue-50">
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                </th>
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡πÄ‡∏û‡∏®
                </th>
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡∏ä‡∏∑‡πà‡∏≠
                </th>
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                </th>
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                </th>
                <th
                  class="px-4 py-3 text-left text-sm font-semibold text-gray-700"
                >
                  ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                </th>
              </tr>
            </thead>
            <tbody id="classroomTableBody">
              <!-- Table rows will be populated here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Search Results Cards -->
      <div id="searchResults" class="hidden">
        <h3 class="text-xl font-semibold text-gray-800 mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
        <div
          id="resultsContainer"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Result cards will be populated here -->
        </div>
      </div>

      <!-- No Results Message -->
      <div id="noResults" class="hidden text-center py-8">
        <div class="text-gray-500 text-lg">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
      </div>
    </div>

    <script>
      let allData = [];
      let currentFilter = "all";

      // Fetch data from API
      async function fetchData() {
        try {
          const response = await fetch(
            "https://opensheet.elk.sh/1fA63Cw6cxgbWMmJ8PQEfUgxxCIbvgApn-NGdGcqM6WY/data"
          );
          const data = await response.json();
          allData = data;

          document.getElementById("loading").classList.add("hidden");
          document.getElementById("statsSection").classList.remove("hidden");
          document.getElementById("searchSection").classList.remove("hidden");

          generateStats();
          setupEventListeners();
        } catch (error) {
          console.error("Error fetching data:", error);
          document.getElementById("loading").innerHTML =
            '<p class="text-red-600">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
        }
      }

      // Generate statistics cards
      function generateStats() {
        const stats = {
          ‡∏ï‡∏£‡∏µ: 0,
          ‡πÇ‡∏ó: 0,
          ‡πÄ‡∏≠‡∏Å: 0,
          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö: 0,
          ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: 0,
        };

        allData.forEach((item) => {
          if (stats.hasOwnProperty(item.statust_test)) {
            stats[item.statust_test]++;
          }
        });

        const colors = {
          ‡∏ï‡∏£‡∏µ: "bg-green-500",
          ‡πÇ‡∏ó: "bg-blue-500",
          ‡πÄ‡∏≠‡∏Å: "bg-amber-600",
          ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö: "bg-gray-500",
          ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: "bg-yellow-500",
        };

        const statsContainer = document.getElementById("statsCards");
        statsContainer.innerHTML = "";

        Object.entries(stats).forEach(([status, count]) => {
          const card = document.createElement("div");
          card.className = "bg-white rounded-lg shadow-md p-4 text-center";
          card.innerHTML = `
                    <div class="w-12 h-12 ${colors[status]} rounded-full mx-auto mb-2 flex items-center justify-center">
                        <span class="text-white font-bold text-lg">${count}</span>
                    </div>
                    <h3 class="font-semibold text-gray-800 text-sm">${status}</h3>
                `;
          statsContainer.appendChild(card);
        });
      }

      // Setup event listeners
      function setupEventListeners() {
        // Name search
        document
          .getElementById("nameSearch")
          .addEventListener("input", function (e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm.length > 0) {
              searchByName(searchTerm);
            } else {
              hideResults();
            }
          });

        // Classroom select
        document
          .getElementById("classroomSelect")
          .addEventListener("change", function (e) {
            const classroom = e.target.value;
            if (classroom) {
              searchByClassroom(classroom);
            } else {
              hideClassroomResults();
            }
          });
      }

      // Filter by status
      // Filter by status
      function filterByStatus(status) {
        currentFilter = status;

        // Update button styles
        document.querySelectorAll(".status-btn").forEach((btn) => {
          btn.classList.remove("active", "bg-blue-600", "text-white");
          btn.classList.add("bg-gray-200", "text-gray-700");
        });
        event.target.classList.add("active", "bg-blue-600", "text-white");
        event.target.classList.remove("bg-gray-200", "text-gray-700");

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ
        hideClassroomResults();

        // Apply filter
        const nameSearch = document
          .getElementById("nameSearch")
          .value.toLowerCase();
        if (nameSearch.length > 0) {
          searchByName(nameSearch);
        } else if (status !== "all") {
          const filtered = allData.filter(
            (item) => item.statust_test === status
          );
          displaySearchResults(filtered);
        } else {
          hideResults();
        }
      }

      // Search by name
      function normalizeThai(text) {
        return text
          ? text.toString().trim().replace(/\s+/g, "") // ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          : "";
      }

      function searchByName(searchTerm) {
        const normalizedSearch = normalizeThai(searchTerm);

        let filtered = allData.filter(
          (item) =>
            normalizeThai(item.name).includes(normalizedSearch) ||
            normalizeThai(item.surname).includes(normalizedSearch)
        );

        if (currentFilter !== "all") {
          filtered = filtered.filter(
            (item) => item.statust_test === currentFilter
          );
        }

        displaySearchResults(filtered);
        hideClassroomResults();
      }

      // Search by classroom
      function searchByClassroom(classroom) {
        const filtered = allData.filter((item) => item.classroom === classroom);
        displayClassroomResults(filtered, classroom);
        hideResults();
      }

      // Display search results as cards
      function displaySearchResults(results) {
        const container = document.getElementById("resultsContainer");
        const resultsSection = document.getElementById("searchResults");
        const noResults = document.getElementById("noResults");

        if (results.length === 0) {
          resultsSection.classList.add("hidden");
          noResults.classList.remove("hidden");
          return;
        }

        noResults.classList.add("hidden");
        resultsSection.classList.remove("hidden");

        container.innerHTML = "";

        results.forEach((item) => {
          const card = document.createElement("div");
          card.className =
            "bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow duration-200";

          const isCompleted =
            item.statust_test && item.statust_test.includes("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          const hasExamRight = item.test === "TRUE" || item.test === true;

          const genderRaw = (item.gender || "").toString().toLowerCase();
          let genderEmoji, genderIcon;

          if (genderRaw.includes("‡∏ä")) {
            genderEmoji = "‚ôÇÔ∏è";
            genderIcon = "üßë"; // ‡∏´‡∏£‡∏∑‡∏≠ üë®
          } else if (genderRaw.includes("‡∏´")) {
            genderEmoji = "‚ôÄÔ∏è";
            genderIcon = "üë©";
          } else {
            genderEmoji = "‚öß";
            genderIcon = "üë§";
          }

          const statusColor =
            {
              ‡∏ï‡∏£‡∏µ: "bg-green-100 text-green-800",
              ‡πÇ‡∏ó: "bg-blue-100 text-blue-800",
              ‡πÄ‡∏≠‡∏Å: "bg-amber-100 text-amber-800",
              ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö: "bg-gray-100 text-gray-800",
              ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: "bg-yellow-100 text-yellow-800",
            }[item.statust_test] || "bg-gray-100 text-gray-800";

          const examInfo = isCompleted
            ? '<p class="text-yellow-600 font-medium">üèÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>'
            : hasExamRight
            ? '<p class="text-green-600 font-medium">‚úì ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≠‡∏ö</p>'
            : '<p class="text-red-600 font-medium">‚úó ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≠‡∏ö</p>';

          card.innerHTML = `
      <div class="flex justify-between items-start mb-3">
        <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColor}">
          ${item.statust_test || "-"}
        </span>
        <span class="text-sm text-gray-500">${item.classroom || "-"}</span>
      </div>

<div class="flex items-center gap-3 mb-2">
  <span class="inline-flex w-9 h-9 items-center justify-center rounded-full bg-indigo-50 text-indigo-600 text-xl">
    ${genderIcon}
  </span>
  <h3 class="text-lg font-semibold text-gray-800 m-0">
    ${item.name || "-"} ${item.surname || ""}
  </h3>
</div>


      <div class="text-sm text-gray-600 space-y-2">
        <p class="flex items-center gap-2">
          <span class="inline-flex w-6 h-6 items-center justify-center text-lg">${genderEmoji}</span>
          <span><span class="font-medium">‡πÄ‡∏û‡∏®:</span> ${
            item.gender || "-"
          }</span>
        </p>

        <p class="flex items-center gap-2">
          <span class="inline-flex w-6 h-6 items-center justify-center text-lg">üéì</span>
          <span><span class="font-medium">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô:</span> ${
            item.status_class || "-"
          }</span>
        </p>

        ${examInfo}
      </div>
    `;

          container.appendChild(card);
        });
      }

      // Display classroom results as table
      // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå pdfMake (‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
      pdfMake.fonts = {
        THSarabunNew: {
          normal: "https://guykorat.github.io/font/THSarabunNew.ttf",
          bold: "https://guykorat.github.io/font/Sarabun-ExtraBold.ttf",
        },
        Charm: {
          normal: "https://guykorat.github.io/font/Charm-Bold.ttf",
          bold: "https://guykorat.github.io/font/Charm-Regular.ttf",
        },
        Prompt: {
          normal: "https://guykorat.github.io/font/Prompt-Regular.ttf",
          bold: "https://guykorat.github.io/font/Prompt-Bold.ttf",
        },
      };

      let currentClassroomData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á

      function displayClassroomResults(results, classroom) {
        const tableBody = document.getElementById("classroomTableBody");
        const resultsSection = document.getElementById("classroomResults");
        const noResults = document.getElementById("noResults");
        const printBtn = document.getElementById("printClassroomBtn");
        const printPdfBtn = document.getElementById("printPdfBtn");

        if (results.length === 0) {
          resultsSection.classList.add("hidden");
          noResults.classList.remove("hidden");
          printBtn.classList.add("hidden");
          printPdfBtn.classList.add("hidden");
          currentClassroomData = [];
          return;
        }

        noResults.classList.add("hidden");
        resultsSection.classList.remove("hidden");
        printBtn.classList.remove("hidden");
        printPdfBtn.classList.remove("hidden");

        tableBody.innerHTML = "";

        results.forEach((item, index) => {
          const row = document.createElement("tr");
          row.className = index % 2 === 0 ? "bg-white" : "bg-gray-50";

          const statusColor =
            {
              ‡∏ï‡∏£‡∏µ: "bg-green-100 text-green-800",
              ‡πÇ‡∏ó: "bg-blue-100 text-blue-800",
              ‡πÄ‡∏≠‡∏Å: "bg-purple-100 text-purple-800",
              ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö: "bg-gray-100 text-gray-800",
              ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏ô‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: "bg-yellow-100 text-yellow-800",
            }[item.statust_test] || "bg-gray-100 text-gray-800";

          row.innerHTML = `
      <td class="px-4 py-3 text-sm text-gray-900">${index + 1}</td>
      <td class="px-4 py-3 text-sm text-gray-900">${item.gender}</td>
      <td class="px-4 py-3 text-sm text-gray-900">${item.name}</td>
      <td class="px-4 py-3 text-sm font-medium text-gray-900">${
        item.surname
      }</td>
      <td class="px-4 py-3 text-sm text-gray-900">${item.classroom}</td>
      <td class="px-4 py-3">
          <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColor}">
              ${item.statust_test}
          </span>
      </td>
    `;
          tableBody.appendChild(row);
        });

        currentClassroomData = results;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏¥‡∏°‡∏û‡πå pdf
      function printPdfClassroom() {
        if (!currentClassroomData.length) {
          alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå PDF");
          return;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á body ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô PDF
        const body = [
          [
            { text: "‡∏•‡∏≥‡∏î‡∏±‡∏ö", style: "tableHeader" },
            { text: "‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤", style: "tableHeader" },
            { text: "‡∏ä‡∏∑‡πà‡∏≠", style: "tableHeader" },
            { text: "‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", style: "tableHeader" },
            { text: "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", style: "tableHeader" },
            { text: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", style: "tableHeader" },
          ],
        ];

        currentClassroomData.forEach((item, index) => {
          body.push([
            index + 1,
            item.gender || "-",
            item.name || "-",
            item.surname || "-",
            item.classroom || "-",
            item.statust_test || "-",
          ]);
        });

        const docDefinition = {
          content: [
            { text: "‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", style: "header" },
            {
              style: "tableExample",
              table: {
                headerRows: 1,
                widths: ["auto", "*", "*", "*", "auto", "auto"],
                body: body,
              },
              layout: {
                fillColor: function (rowIndex) {
                  if (rowIndex === 0) {
                    return "#CCCCCC"; // ‡∏™‡∏µ header
                  }
                  // rowIndex 1 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡∏•‡∏ö 1 ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ body index -1)
                  const dataIndex = rowIndex - 1;
                  if (
                    currentClassroomData[dataIndex] &&
                    currentClassroomData[dataIndex].statust_test ===
                      "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö"
                  ) {
                    return "#f8d7da"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏≠‡πà‡∏≠‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö
                  }
                  return null;
                },
              },
            },
          ],
          defaultStyle: {
            font: "THSarabunNew",
            fontSize: 16,
          },
          styles: {
            header: {
              fontSize: 20,
              bold: true,
              marginBottom: 15,
            },
            tableExample: {
              margin: [0, 5, 0, 15],
            },
            tableHeader: {
              bold: true,
              fontSize: 12,
              color: "black",
            },
          },
          pageOrientation: "portrait",
          pageSize: "A4",
        };

        pdfMake.createPdf(docDefinition).open();
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
      function printClassroomTable() {
        const printContents = document.getElementById(
          "classroomTableWrapper"
        ).innerHTML;
        const originalContents = document.body.innerHTML;

        document.body.innerHTML = printContents;

        window.print();

        document.body.innerHTML = originalContents;

        // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
        window.location.reload();
      }

      // Hide results
      function hideResults() {
        document.getElementById("searchResults").classList.add("hidden");
        document.getElementById("noResults").classList.add("hidden");
      }

      // Hide classroom results
      function hideClassroomResults() {
        document.getElementById("classroomResults").classList.add("hidden");
      }
      document.addEventListener("DOMContentLoaded", (event) => {
        // Initialize the application
        fetchData();
      });
    </script>
  </body>
</html>
